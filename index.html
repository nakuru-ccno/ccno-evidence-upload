<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CCNO Evidence Upload</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f6f9; margin: 0; padding: 0; color: #333; }
  header { display: flex; align-items: center; gap: 12px; background: #0277bd; padding: 12px 18px; color: #fff; font-weight: 700; font-size: 1.05rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  header img { height: 52px; width: 52px; object-fit: contain; background: #fff; border-radius: 50%; padding: 4px; }
  .container { max-width: 720px; background: #fff; margin: 36px auto; padding: 28px 32px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); border-top: 6px solid #2e7d32; }
  h2 { text-align: center; font-weight: 800; color: #b71c1c; margin: 0 0 20px; }
  label { display: block; margin-top: 16px; font-weight: 700; color: #2e7d32; }
  input[type="text"], select, input[type="file"] { width: 100%; padding: 12px 14px; margin-top: 8px; border: 1px solid #cfd8dc; border-radius: 8px; font-size: 1rem; background: #fff; box-sizing: border-box; }
  input[type="text"]:focus, select:focus, input[type="file"]:focus { outline: none; border-color: #0277bd; box-shadow: 0 0 0 3px rgba(2,119,189,0.15); }
  small { display: block; font-size: 0.85em; color: #607d8b; margin-top: 6px; }
  button { margin-top: 22px; width: 100%; padding: 14px 16px; font-size: 1.05rem; background: #b71c1c; color: #fff; border: none; border-radius: 10px; cursor: pointer; font-weight: 800; }
  button:hover { background: #d32f2f; }
  .spinner { display: none; margin: 16px 0; text-align: center; color: #b71c1c; font-weight: 700; }
  .success, .error { display: none; margin: 18px 0; padding: 14px 16px; border-radius: 8px; font-weight: 700; }
  .success { background: #e3f2fd; color: #0d47a1; border: 1px solid #90caf9; }
  .error { background: #ffebee; color: #b71c1c; border: 1px solid #ef9a9a; }
</style>
</head>
<body>
<header>
  <img src="https://www.nakurucountychiefnursingofficer.site/lovable-uploads/00cc8120-039e-4419-8b2b-e07e69d6fdd8.png" alt="Nakuru County Logo" />
  Q1 FY 25/26 Performance Contract
</header>

<div class="container">
  <h2>Nakuru County CCNO PC Evidence Upload</h2>

  <label for="evidenceName">Evidence Name:</label>
  <input type="text" id="evidenceName" placeholder="e.g., CME on Family Planning Methods" />

  <label for="category">Evidence Category:</label>
  <select id="category">
    <option value="">Select Evidence Category</option>
    <option value="D3 - Immunization Coverage Increased">D3 - Immunization Coverage Increased</option>
    <option value="D12 - Referral system improved">D12 - Referral system improved</option>
    <option value="D14 - Operationalization of health facilities to offer better services">D14 - Operationalization of health facilities to offer better services</option>
    <option value="D19 - Theatre Services improved">D19 - Theatre Services improved</option>
    <option value="D20 - In-patient Services Improved">D20 - In-patient Services Improved</option>
    <option value="D23 - Antenatal Care Services improved">D23 - Antenatal Care Services improved</option>
    <option value="D24 - Postnatal Care Improved">D24 - Postnatal Care Improved</option>
    <option value="D25 - Maternal Perinatal Deaths Audited">D25 - Maternal Perinatal Deaths Audited</option>
    <option value="D26 - Family Planning Uptake improved">D26 - Family Planning Uptake improved</option>
    <option value="D27 - Burden of Cancer Reduced">D27 - Burden of Cancer Reduced</option>
    <option value="D29 - Health Services Supervision">D29 - Health Services Supervision</option>
    <option value="D35 - Youth Empowerment Initiatives">D35 - Youth Empowerment Initiatives</option>
  </select>

  <label for="indicator">Indicator:</label>
  <select id="indicator">
    <option value="">Select Indicator</option>
  </select>

  <label for="subCounty">Sub County:</label>
  <select id="subCounty">
    <option value="">Select Sub County</option>
    <option value="Nakuru West Sub County">Nakuru West Sub County</option>
    <option value="Nakuru East Sub County">Nakuru East Sub County</option>
    <option value="Nakuru North Sub County">Nakuru North Sub County</option>
    <option value="Naivasha Sub County">Naivasha Sub County</option>
    <option value="Rongai Sub County">Rongai Sub County</option>
    <option value="Kuresoi South Sub County">Kuresoi South Sub County</option>
    <option value="Kuresoi North Sub County">Kuresoi North Sub County</option>
    <option value="Subukia Sub County">Subukia Sub County</option>
    <option value="Molo Sub County">Molo Sub County</option>
    <option value="Njoro Sub County">Njoro Sub County</option>
    <option value="Gilgil Sub County">Gilgil Sub County</option>
  </select>

  <label for="files">Choose PDF file(s):</label>
  <input type="file" id="files" accept="application/pdf" multiple />

  <div class="spinner" id="spinner">‚è≥ Uploading...</div>
  <div class="success" id="success"></div>
  <div class="error" id="error"></div>

  <button id="uploadBtn">Upload PDF Evidence</button>
</div>

<script>
const PROXY_URL = "https://nccnoproxyy.onrender.com/upload-evidence";

const evidenceNameInput = document.getElementById("evidenceName");
const categorySelect = document.getElementById("category");
const indicatorSelect = document.getElementById("indicator");
const subCountySelect = document.getElementById("subCounty");
const filesInput = document.getElementById("files");
const spinner = document.getElementById("spinner");
const successMsg = document.getElementById("success");
const errorMsg = document.getElementById("error");
const uploadBtn = document.getElementById("uploadBtn");

// Indicators aligned with Apps Script folderMap
const indicatorsMap = {
  "D3 - Immunization Coverage Increased": [
    "Avail immunization services on daily basis 8am-5pm",
    "Conduct continuous Immunization defaulter tracing",
    "Conduct quarterly CCE assessment in all the immunizing facilities",
    "Conduct monthly integrated outreaches"
  ],
  "D12 - Referral system improved": [
    "Strengthen referral system-Revise and disseminate SOPs",
    "Formulate ambulance checklist to ensure consistent availability of emergency response commodities",
    "Procure 2 ACLS ambulances for Naivasha and Molo",
    "Relocate the call Centre to NCRTH and strengthen the call Centre by acquiring a dedicated toll free number"
  ],
  "D14 - Operationalization of health facilities to offer better services": [
    "Operationalize Level 4 new Maternity units in Bondeni, Molo, Gilgil and Githioro L3",
    "Equip 6 new health facilities"
  ],
  "D19 - Theatre Services improved": [
    "Deployment of HRH to operationalize Subukia, Elburgon and Gilgil Theatres",
    "Procurement of Theater equipment for Subukia",
    "Operationalize the theatre at Bondeni SCH"
  ],
  "D20 - In-patient Services Improved": [
    "Hold Hospital Quarterly clinical audit team meetings in level IV / V hospitals (50%)",
    "Conduct quarterly Supportive Supervision of all the 16 Level IV & V Hospitals (50%)"
  ],
  "D23 - Antenatal Care Services improved": [
    "Establish/Strengthen cohort group ANC(GANC)",
    "Scale up the number of facilities Enrolling ANC mothers to SMS PROMPTS from 57 to 90",
    "Procure essential and emergency neonatal care equipment",
    "Establish/Strengthen cohort group ANC(GANC)"
  ],
  "D24 - Postnatal Care Improved": [
    "Integrate cervical cancer screening in postnatal clinic",
    "Provision of PNC within the first 48 hours in all the delivery units"
  ],
  "D25 - Maternal Perinatal Deaths Audited": [
    "Conduct monthly facility and sub county MPDSR Audit meeting",
    "Track and Implement recommendations of the action points from the MPDSR meetings",
    "Conduct weekly virtual MPDSR meeting at all levels of care"
  ],
  "D26 - Family Planning Uptake improved": [
    "Operationalization of the 2 AYSRH centres .( Ronda HC and Mau Narok HC)",
    "Mentorship / OJT on long acting and reversible contraceptive methods, including Hormonal IUD",
    "Roll out the self-care initiative in reproductive health and DMPA-SC injection",
    "Requisition of family planning commodities"
  ],
  "D27 - Burden of Cancer Reduced": [
    "Undertake cervical cancer Screening",
    "Treatment of cervical cancer lesions",
    "Administration of the HPV 1 vaccine to girls 10 years-14 years.",
    "Conduct psychosocial support counselling for cancer survivors"
  ],
  "D29 - Health Services Supervision": [
    "Undertake 3 CHMT supervisions per quarter",
    "SCHMT undertake 33 supervisions",
    "Report on implementation of CHMT  and SCHMT supervision"
  ],
  "D35 - Youth Empowerment Initiatives": [
    "Establishment of youth Friendly Centres in Facilities",
    "Sensitize the youth on YFS,Live saving skills  and Alcohol & Substance Abuse integrate into school health programme",
    "Provision of psychological counselling services in youth friendly centres"
  ]
};

// Populate indicators dynamically
categorySelect.addEventListener("change", () => {
  const category = categorySelect.value;
  indicatorSelect.innerHTML = '<option value="">Select Indicator</option>';
  if (indicatorsMap[category]) {
    indicatorsMap[category].forEach(ind => {
      const opt = document.createElement("option");
      opt.value = ind;
      opt.textContent = ind;
      indicatorSelect.appendChild(opt);
    });
  }
});

function showError(msg) {
  errorMsg.style.display = msg ? "block" : "none";
  errorMsg.textContent = msg;
  successMsg.style.display = "none";
}

function showSuccess(msg) {
  successMsg.style.display = "block";
  successMsg.textContent = msg;
  errorMsg.style.display = "none";

  // Auto-hide after 4 seconds
  setTimeout(() => {
    successMsg.style.display = "none";
  }, 4000);
}

function resetForm() {
  evidenceNameInput.value = "";
  categorySelect.value = "";
  indicatorSelect.innerHTML = '<option value="">Select Indicator</option>';
  subCountySelect.value = "";
  filesInput.value = "";
}

uploadBtn.addEventListener("click", async () => {
  const evidenceName = evidenceNameInput.value.trim();
  const category = categorySelect.value;
  const indicator = indicatorSelect.value;
  const subCounty = subCountySelect.value;
  const files = filesInput.files;

  if (!evidenceName || !category || !indicator || !subCounty || !files.length) {
    return showError("Please fill all fields and select at least one PDF file.");
  }

  spinner.style.display = "block";
  showError("");

  try {
    const formData = new FormData();
    formData.append("evidenceName", evidenceName);
    formData.append("category", category);
    formData.append("indicator", indicator);
    formData.append("subCounty", subCounty);
    for (let file of files) {
      formData.append("files", file, file.name);
    }

    const response = await fetch(PROXY_URL, {
      method: "POST",
      body: formData
    });

    const result = await response.json();
    spinner.style.display = "none";

    if (response.ok) {
      showSuccess(`${evidenceName} - ${subCounty}.pdf submitted successfully!`);
      resetForm();
    } else {
      showError(result.error || "Upload failed. Try again.");
    }
  } catch (err) {
    spinner.style.display = "none";
    showError("Network error: " + err.message);
  }
});
</script>
</body>
</html>
