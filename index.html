<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CCNO Evidence Upload</title>
<style>
  /* Reset and body */
  * { box-sizing: border-box; margin:0; padding:0; }
  body { font-family: 'Segoe UI', sans-serif; background:#f4f6f9; color:#333; }

  /* Header */
  header { 
    background:#0277bd; 
    color:#fff; 
    padding:24px 16px; 
    text-align:center; 
    font-weight:700; 
    font-size:1.2rem; 
    width:100%;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
  }

  /* Container */
  .container { 
    max-width:720px; 
    margin:24px auto; 
    padding:24px; 
    background:#fff; 
    border-radius:12px; 
    box-shadow:0 4px 12px rgba(0,0,0,0.1); 
  }

  /* Form */
  label { display:block; margin-top:16px; font-weight:700; }
  input, select { width:100%; padding:12px; margin-top:6px; border-radius:8px; border:1px solid #ccc; font-size:1rem; }
  input[type="file"] { padding:4px; }

  .info { font-size:0.9rem; color:#555; margin-top:4px; }
  button { margin-top:20px; width:100%; padding:14px; background:#b71c1c; color:#fff; border:none; border-radius:10px; font-weight:700; cursor:pointer; font-size:1rem; }
  button:hover { background:#d32f2f; }

  /* Feedback */
  .spinner, .success, .error { display:none; margin-top:16px; padding:10px; border-radius:8px; }
  .spinner { color:#b71c1c; font-weight:700; text-align:center; }
  .success { background:#e3f2fd; color:#0d47a1; border:1px solid #90caf9; }
  .error { background:#ffebee; color:#b71c1c; border:1px solid #ef9a9a; }

  /* Progress bar */
  .progress-container { display:none; margin-top:16px; background:#eee; border-radius:8px; height:18px; overflow:hidden; }
  .progress-bar { height:100%; width:0%; background:#2e7d32; transition:width 0.2s ease; }

  /* Responsive */
  @media(max-width:480px){
    header { font-size:1rem; padding:20px 12px; }
    input, select { font-size:0.95rem; padding:10px; }
    button { font-size:0.95rem; padding:12px; }
  }
</style>
</head>
<body>
<header>üì§ CCNO Evidence Upload</header>

<div class="container">
  <label for="officerEmail">Officer Email:</label>
  <input type="email" id="officerEmail" placeholder="Enter your official email" required>
  <div class="info">üì© You will receive an email confirmation once your files are saved.</div>

  <label for="evidenceName">Evidence Name:</label>
  <input type="text" id="evidenceName" placeholder="e.g., CME on Family Planning Methods">

  <label for="category">Evidence Category:</label>
  <select id="category">
    <option value="">Select Evidence Category</option>
  </select>

  <label for="indicator">Indicator:</label>
  <select id="indicator">
    <option value="">Select Indicator</option>
  </select>

  <label for="subCounty">Sub County:</label>
  <select id="subCounty">
    <option value="">Select Sub County</option>
    <option>Nakuru West Sub County</option>
    <option>Nakuru East Sub County</option>
    <option>Nakuru North Sub County</option>
    <option>Naivasha Sub County</option>
    <option>Rongai Sub County</option>
    <option>Kuresoi South Sub County</option>
    <option>Kuresoi North Sub County</option>
    <option>Subukia Sub County</option>
    <option>Molo Sub County</option>
    <option>Njoro Sub County</option>
    <option>Gilgil Sub County</option>
  </select>

  <label for="files">Choose PDF file(s):</label>
  <input type="file" id="files" accept="application/pdf" multiple>

  <div class="spinner" id="spinner">‚è≥ Uploading...</div>
  <div class="progress-container" id="progressContainer"><div class="progress-bar" id="progressBar"></div></div>
  <div class="success" id="success"></div>
  <div class="error" id="error"></div>

  <button id="uploadBtn">Upload PDF Evidence</button>
</div>

<script>
const PROXY_URL = "https://nccnoproxyy.onrender.com/upload-evidence";
const officerEmailInput = document.getElementById("officerEmail");
const evidenceNameInput = document.getElementById("evidenceName");
const categorySelect = document.getElementById("category");
const indicatorSelect = document.getElementById("indicator");
const subCountySelect = document.getElementById("subCounty");
const filesInput = document.getElementById("files");
const spinner = document.getElementById("spinner");
const successMsg = document.getElementById("success");
const errorMsg = document.getElementById("error");
const uploadBtn = document.getElementById("uploadBtn");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");

fetch("indicators.json")
  .then(res => res.json())
  .then(data => {
    Object.keys(data).forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat; opt.textContent = cat; categorySelect.appendChild(opt);
    });
    categorySelect.addEventListener("change",()=>{
      const selected=categorySelect.value;
      indicatorSelect.innerHTML='<option value="">Select Indicator</option>';
      if(data[selected]) data[selected].forEach(ind=>{const opt=document.createElement("option"); opt.value=ind; opt.textContent=ind; indicatorSelect.appendChild(opt);});
    });
  });

function showError(msg){ errorMsg.style.display=msg?"block":"none"; errorMsg.textContent=msg; successMsg.style.display="none"; }
function showSuccess(msg){ successMsg.style.display="block"; successMsg.textContent=msg; errorMsg.style.display="none"; setTimeout(()=>successMsg.style.display="none",4000);}
function resetForm(){ officerEmailInput.value=""; evidenceNameInput.value=""; categorySelect.value=""; indicatorSelect.innerHTML='<option value="">Select Indicator</option>'; subCountySelect.value=""; filesInput.value=""; progressBar.style.width="0%"; progressContainer.style.display="none"; }

uploadBtn.addEventListener("click",()=>{
  const officerEmail=officerEmailInput.value.trim();
  const evidenceName=evidenceNameInput.value.trim();
  const category=categorySelect.value;
  const indicator=indicatorSelect.value;
  const subCounty=subCountySelect.value;
  const files=filesInput.files;

  if(!officerEmail||!evidenceName||!category||!indicator||!subCounty||!files.length) return showError("‚ö†Ô∏è Please fill all fields and select at least one PDF file.");
  if(files.length>10) return showError("‚ö†Ô∏è You can only upload up to 10 PDF files.");
  for(let file of files){ if(file.type!=="application/pdf") return showError(`‚ö†Ô∏è ${file.name} is not a PDF.`); if(file.size>30*1024*1024) return showError(`‚ö†Ô∏è ${file.name} exceeds 30MB.`);}
  
  spinner.style.display="block"; progressContainer.style.display="block"; progressBar.style.width="0%"; showError("");
  const formData=new FormData();
  formData.append("officerEmail",officerEmail);
  formData.append("evidenceName",evidenceName);
  formData.append("category",category);
  formData.append("indicator",indicator);
  formData.append("subCounty",subCounty);
  for(let file of files) formData.append("files[]",file,file.name);

  const xhr=new XMLHttpRequest();
  xhr.open("POST",PROXY_URL,true);
  xhr.upload.onprogress=e=>{ if(e.lengthComputable){ progressBar.style.width=((e.loaded/e.total)*100)+"%"; } };
  xhr.onload=()=>{ spinner.style.display="none"; xhr.status>=200&&xhr.status<300?showSuccess(`‚úÖ ${files.length} file(s) submitted successfully. üì© Email confirmation sent.`):showError("‚ùå Upload failed. Try again."); resetForm();};
  xhr.onerror=()=>{ spinner.style.display="none"; showError("‚ùå Network error. Try again."); };
  xhr.send(formData);
});
</script>
</body>
</html>
