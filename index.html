<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Evidence Upload</title>
</head>
<body>
  <h2>Upload Evidence PDF(s)</h2>
  <form id="uploadForm">
    <label>
      Evidence Name:<br />
      <input type="text" id="evidenceName" required />
    </label><br /><br />
    
    <label>
      Folder ID:<br />
      <input type="text" id="folderId" placeholder="Google Drive Folder ID" required />
    </label><br /><br />
    
    <label>
      Sub County:<br />
      <input type="text" id="subCounty" required />
    </label><br /><br />
    
    <label>
      Choose PDF files (max 3MB each, multiple allowed):<br />
      <input type="file" id="fileInput" accept="application/pdf" multiple required />
    </label><br /><br />
    
    <button type="submit">Upload</button>
  </form>

  <div id="result" style="margin-top:20px;"></div>

  <script>
    const scriptURL = 'YOUR_WEB_APP_URL'; // Replace with your Apps Script Web App URL

    document.getElementById('uploadForm').addEventListener('submit', async e => {
      e.preventDefault();

      const evidenceName = document.getElementById('evidenceName').value.trim();
      const folderId = document.getElementById('folderId').value.trim();
      const subCounty = document.getElementById('subCounty').value.trim();
      const files = document.getElementById('fileInput').files;

      const resultDiv = document.getElementById('result');
      resultDiv.textContent = '';
      
      if (files.length === 0) {
        resultDiv.textContent = 'Please select at least one PDF file.';
        return;
      }

      // Validate files (PDF and max 3MB)
      for (const file of files) {
        if (file.type !== 'application/pdf') {
          resultDiv.textContent = `File "${file.name}" is not a PDF.`;
          return;
        }
        if (file.size > 3 * 1024 * 1024) {
          resultDiv.textContent = `File "${file.name}" exceeds 3MB size limit.`;
          return;
        }
      }

      // Upload files sequentially
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        try {
          const base64 = await toBase64(file);
          const base64Data = base64.replace(/^data:application\/pdf;base64,/, '');

          const payload = {
            base64Data: base64Data,
            evidenceName: evidenceName,
            folderId: folderId,
            subCounty: subCounty,
            fileName: file.name
          };

          const response = await fetch(scriptURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!response.ok) throw new Error('Upload failed');

          const text = await response.text();
          resultDiv.textContent += `Uploaded "${file.name}" successfully.\n`;

        } catch (err) {
          resultDiv.textContent += `Error uploading "${file.name}": ${err.message}\n`;
        }
      }
    });

    // Helper to convert file to base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }
  </script>
</body>
</html>
