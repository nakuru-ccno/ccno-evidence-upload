<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reset Password</title>
<style>
body { font-family: Arial, sans-serif; background:#f9f9f9; display:flex; justify-content:center; align-items:center; height:100vh; }
.box { background:#fff; padding:30px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); max-width:400px; width:100%; text-align:center; }
h2 { margin-bottom:20px; }
input { width:100%; padding:12px; margin:8px 0; border:1px solid #ccc; border-radius:8px; }
button { width:100%; padding:14px; background:#2e7d32; color:#fff; border:none; border-radius:10px; font-size:1rem; cursor:pointer; }
button:hover { background:#1b5e20; }
.message { margin-top:15px; text-align:center; font-weight:600; }
.toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#2e7d32; color:#fff; padding:12px 20px; border-radius:8px; display:none; }
.toast.show { display:block; animation:fadein 0.5s, fadeout 0.5s 2.5s; }
@keyframes fadein { from {opacity:0;} to {opacity:1;} }
@keyframes fadeout { from {opacity:1;} to {opacity:0;} }
</style>
</head>
<body>
<div class="box">
<h2>Reset Password</h2>
<input type="password" id="newPassword" placeholder="Enter new password">
<button onclick="resetPassword()">Update Password</button>
<div class="message" id="msg"></div>
</div>

<div id="toast" class="toast">Password updated successfully! Redirecting to login...</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxb1JGCK2Sp2oCtp4UtzVvYW9w4RIchaVD4UthhDLRO30bnzju-ZDsXDgRF7FtJuB4/exec";

async function resetPassword(){
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");
  const password = document.getElementById("newPassword").value;
  const msg = document.getElementById("msg");

  if(!password){ 
    msg.innerHTML = `<span style="color:red">Please enter a new password.</span>`; 
    return; 
  }

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      body:JSON.stringify({ action:"resetPassword", token, password })
    });
    const data = await res.json();
    if(data.success){
      showToast("âœ… Password updated! Redirecting to login...");
      setTimeout(()=>{ window.location.href="https://pce.nakurucountychiefnursingofficer.site"; }, 3000);
    } else{
      msg.innerHTML=`<span style="color:red">${data.message}</span>`;
    }
  } catch(err){
    msg.innerHTML=`<span style="color:red">Error updating password.</span>`;
  }
}

function showToast(message){
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(()=>{ toast.classList.remove("show"); }, 3000);
}
</script>
</body>
</html>
